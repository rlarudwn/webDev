<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.mapper.recipe-mapper">
<select id="recipeListData" parameterType="hashmap" resultType="RecipeVO">
SELECT no,title,poster,num
   FROM (SELECT no,title,poster,rownum as num
   FROM (SELECT /*+ INDEX_ASC(recipe recipe_no_pk)*/no,title,poster
   FROM recipe WHERE no IN(SELECT no FROM recipe INTERSECT SELECT no FROM recipeDetail)))
   WHERE num BETWEEN #{start} AND #{end}
</select>
<select id="recipeTotalCount" resultType="int">
SELECT count(*) FROM recipe WHERE no IN(SELECT no FROM recipe INTERSECT SELECT no FROM recipeDetail)
</select>
<update id="recipeHitIncrement" parameterType="int">
UPDATE recipe SET hit=hit+1 WHERE no=#{no}
</update>
<select id="recipeDetailData" parameterType="int" resultType="RecipeDetailVO">
SELECT * FROM recipeDetail WHERE no=#{no}
</select>
<select id="recipeChefListData" parameterType="hashmap" resultType="ChefVO">
SELECT chef, poster, mem_cont1, mem_cont3, mem_cont7, mem_cont2, num
FROM (SELECT chef, poster, mem_cont1, mem_cont3, mem_cont7, mem_cont2, rownum as num
FROM (SELECT chef, poster, mem_cont1, mem_cont3, mem_cont7, mem_cont2 
FROM chef))
WHERE num BETWEEN #{start} AND #{end}
</select>
<select id="recipeChefTotalPage" resultType="int">
SELECT CEIL(COUNT(*)/50.0) FROM chef
</select>
<select id="chefMakeListData" parameterType="hashmap" resultType="RecipeVO">
SELECT no,title,poster,num
   FROM (SELECT no,title,poster,rownum as num
   FROM (SELECT /*+ INDEX_ASC(recipe recipe_no_pk)*/no,title,poster
   FROM recipe WHERE no IN(SELECT no FROM recipe INTERSECT SELECT no FROM recipeDetail) AND chef=#{chef}))
   WHERE num BETWEEN #{start} AND #{end}
</select>
<select id="chefMakeTotalPage" resultType="int" parameterType="String">
SELECT CEIL(count(*)/20.0) FROM recipe WHERE no IN(SELECT no FROM recipe INTERSECT SELECT no FROM recipeDetail) AND chef=#{chef}
</select>
</mapper>